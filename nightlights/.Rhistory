if (length(nl.vals) == 0){
df$nl_mean[i] <- 0
df$nl_min[i] <- 0
df$nl_max[i] <- 0
df$nl_sd[i] <- 0
}
else {
df$nl_mean[i] <- mean(nl.vals, na.rm = T)
df$nl_min[i] <- min(nl.vals, na.rm = T)
df$nl_max[i] <- max(nl.vals, na.rm = T)
df$nl_sd[i] <- sd(nl.vals, na.rm = T)
}
}
return(df)
}
get_consumption <- function(loc){
col <- cons[cons$V1 == loc,]
if (nrow(col) == 0){
value <- 0
}
else {
value <- col$V2
}
return(value)
}
get_consumption <- function(loc){
col <- cons[cons$V1 == loc,]
if (nrow(col) == 0){
value <- 0
}
else {
value <- col$V2
}
return(value)
}
nl.with_zero <- with_zero(nl.data)
nl.no_zero <- no_zero(nl.data)
nl.with_zero <- merge(nl.with_zero, cons, by='loc', all=FALSE)
nl.with_zero$consumption <- as.numeric(nl.with_zero$consumption)
as.numeric("123,456")
as.numeric("123")
nl.with_zero$consumption <- as.numeric(gsub(",","",nl.with_zero$consumption))
nl.with_zero <- with_zero(nl.data)
nl.no_zero <- no_zero(nl.data)
nl.with_zero <- merge(nl.with_zero, cons, by='loc', all=FALSE)
nl.with_zero$consumption <- as.numeric(gsub(",","",nl.with_zero$consumption))
nl.no_zero <- merge(nl.no_zero, cons, by='loc', all=FALSE)
nl.no_zero$consumption <- as.numeric(gsub(",","",nl.no_zero$consumption))
write.csv(nl.with_zero, file=OUT_ZERO, row.names=FALSE)
write.csv(nl.no_zero, file=OUT_NO_ZERO, row.names=FALSE)
FEATURES_Z <- "../data/output/PH2012_features_zero.csv"
FEATURES_NZ <- "../data/output/PH2012_features_no_zero.csv"
nightlights_z <- read.csv(FEATURES_Z)
nightlights_nz <- read.csv(FEATURES_NZ)
str(nightlights_z)
ggplot(nightlights_nz, aes(x = consumption, y = nl_mean)) +
geom_point(color='blue', alpha=0.4) +
geom_smooth(method='loess', color='black') +
ggtitle("Wealth Score vs. Nightlight Intensity per Cluster (Philippines 2008)") +
xlab("Wealth Index Factor Score") +
ylab("Nightlight Intensity")
linear_reg <- lm(consumption ~ nl_mean + nl_min + nl_max + nl_sd,
data = nightlights_nz)
summary(linear_reg)
ggplot(nightlights_z, aes(x = consumption, y = nl_mean)) +
geom_point(color='blue', alpha=0.4) +
geom_smooth(method='loess', color='black') +
ggtitle("Wealth Score vs. Nightlight Intensity per Cluster (Philippines 2008)") +
xlab("Wealth Index Factor Score") +
ylab("Nightlight Intensity")
linear_reg <- lm(consumption ~ nl_mean + nl_min + nl_max + nl_sd,
data = nightlights_z)
summary(linear_reg)
ggplot(nightlights_nz, aes(x = consumption, y = nl_mean)) +
geom_point(color='blue', alpha=0.4) +
geom_smooth(method='loess', color='black') +
ggtitle("Wealth Score vs. Nightlight Intensity per Cluster (Philippines 2008)") +
xlab("Wealth Index Factor Score") +
ylab("Nightlight Intensity")
linear_reg <- lm(consumption ~ nl_mean + nl_min + nl_max + nl_sd,
data = nightlights_nz)
summary(linear_reg)
nightlights_z <- read.csv(FEATURES_Z)
nightlights_z <- read.csv(FEATURES_Z)
nightlights_z$consumption <- log(nightlights_z$consumption)
str(nightlights_z)
ggplot(nightlights_z, aes(x = consumption, y = nl_mean)) +
geom_point(color='blue', alpha=0.4) +
geom_smooth(method='loess', color='black') +
ggtitle("Wealth Score vs. Nightlight Intensity per Cluster (Philippines 2008)") +
xlab("Wealth Index Factor Score") +
ylab("Nightlight Intensity")
linear_reg <- lm(consumption ~ nl_mean + nl_min + nl_max + nl_sd,
data = nightlights_z)
summary(linear_reg)
FEATURES_Z <- "../data/output/PH2012_features_zero.csv"
FEATURES_NZ <- "../data/output/PH2012_features_no_zero.csv"
nightlights_z <- read.csv(FEATURES_Z)
ggplot(nightlights_z, aes(x = consumption, y = nl_mean)) +
geom_point(color='blue', alpha=0.4) +
geom_smooth(method='loess', color='black') +
ggtitle("Wealth Score vs. Nightlight Intensity per Cluster (Philippines 2008)") +
xlab("Average Expenditure Provinces and NCR Cities") +
ylab("Nightlight Intensity")
ggplot(nightlights_z, aes(x = consumption, y = nl_mean)) +
geom_point(color='blue', alpha=0.4) +
geom_smooth(method='loess', color='black') +
ggtitle(paste0("Consumption vs. Nightlight Intensity (Philippines ", YEAR,")")) +
xlab("Average Expenditure Provinces and NCR Cities") +
ylab("Nightlight Intensity")
YEAR <- "2012"
YEAR <- "2012"
FEATURES_Z <- paste0("../data/output/PH", YEAR, "_features_zero.csv")
nightlights_z <- read.csv(FEATURES_Z)
ggplot(nightlights_z, aes(x = consumption, y = nl_mean)) +
geom_point(color='blue', alpha=0.4) +
geom_smooth(method='loess', color='black') +
ggtitle(paste0("Consumption vs. Nightlight Intensity (Philippines ", YEAR,")")) +
xlab("Average Expenditure Provinces and NCR Cities") +
ylab("Nightlight Intensity")
ggplot(nightlights_z, aes(x = consumption, y = nl_mean)) +
geom_point(color='blue', alpha=0.4) +
geom_smooth(method='loess', color='black') +
ggtitle(paste0("Consumption-based Wealth vs. Nightlight Intensity (Philippines ", YEAR,")")) +
xlab("Average Expenditure Provinces and NCR Cities") +
ylab("Nightlight Intensity")
ggplot(nightlights_z, aes(x = consumption, y = nl_mean)) +
geom_point(color='blue', alpha=0.4) +
geom_smooth(method='loess', color='black') +
ggtitle(paste0("Consumption-based Wealth vs. Nightlight Intensity (Philippines ", YEAR,")")) +
xlab("Average Expenditure Provinces and NCR Cities (Pesos)") +
ylab("Nightlight Intensity")
linear_reg <- lm(consumption ~ nl_mean + nl_min + nl_max + nl_sd,
data = nightlights)
summary(linear_reg)
FEATURES <- paste0("../data/output/PH", YEAR, "_features_zero.csv")
nightlights <- read.csv(FEATURES_Z)
ggplot(nightlights, aes(x = consumption, y = nl_mean)) +
geom_point(color='blue', alpha=0.4) +
geom_smooth(method='loess', color='black') +
ggtitle(paste0("Consumption-based Wealth vs. Nightlight Intensity (Philippines ", YEAR,")")) +
xlab("Average Expenditure Provinces and NCR Cities (Pesos)") +
ylab("Nightlight Intensity")
linear_reg <- lm(consumption ~ nl_mean + nl_min + nl_max + nl_sd,
data = nightlights)
summary(linear_reg)
df <- augment(linear_reg)
ggplot(df, aes(x = wealthscore, y = .fitted)) +
geom_point(color='purple', alpha=0.4) +
geom_abline() +
ggtitle(paste("Nightlight Intensity (Philippines 2003); Adj R2 = ", signif(summary(linear_reg)$adj.r.squared, 4))) +
xlab("Observed Wealth Index Factor Score") +
ylab("Predicted Wealth Index Factor Score")
ggplot(df, aes(x = consumption, y = .fitted)) +
geom_point(color='purple', alpha=0.4) +
geom_abline() +
ggtitle(paste("Nightlight Intensity (Philippines 2003); Adj R2 = ", signif(summary(linear_reg)$adj.r.squared, 4))) +
xlab("Observed Wealth Index Factor Score") +
ylab("Predicted Wealth Index Factor Score")
ggplot(df, aes(x = consumption, y = .fitted)) +
geom_point(color='purple', alpha=0.4) +
geom_abline() +
ggtitle(paste("Nightlight Intensity (Philippines 2003); Adj R2 = ", signif(summary(linear_reg)$adj.r.squared, 4))) +
xlab("Observed Expenditure") +
ylab("Predicted Expenditure")
df <- augment(linear_reg)
ggplot(df, aes(x = consumption, y = .fitted)) +
geom_point(color='purple', alpha=0.4) +
geom_abline() +
ggtitle(paste("Nightlight Intensity (Philippines ", YEAR,"); Adj R2 = ", signif(summary(linear_reg)$adj.r.squared, 4))) +
xlab("Observed Expenditure") +
ylab("Predicted Expenditure")
ggplot(df, aes(x = .fitted, y = .resid)) +
geom_point(color='red', alpha=0.4) +
xlab("Fitted Wealth Index Factor Score") +
ylab("Linear Regression Residuals") +
ggtitle("Nightlights Regression Residuals (Philippines 2003)")
ggplot(df, aes(x = .fitted, y = .resid)) +
geom_point(color='red', alpha=0.4) +
xlab("Fitted Wealth Index Factor Score") +
ylab("Linear Regression Residuals") +
ggtitle("Nightlights Regression Residuals (Philippines ",YEAR,")")
df <- augment(linear_reg)
ggplot(df, aes(x = consumption, y = .fitted)) +
geom_point(color='purple', alpha=0.4) +
geom_abline() +
ggtitle(paste("Nightlight Intensity (Philippines ", YEAR,"); Adj R2 = ", signif(summary(linear_reg)$adj.r.squared, 4))) +
xlab("Observed Expenditure") +
ylab("Predicted Expenditure")
ggplot(df, aes(x = .fitted, y = .resid)) +
geom_point(color='red', alpha=0.4) +
xlab("Fitted Wealth Index Factor Score") +
ylab("Linear Regression Residuals") +
ggtitle("Nightlights Regression Residuals (Philippines ",YEAR,")")
df <- augment(linear_reg)
ggplot(df, aes(x = consumption, y = .fitted)) +
geom_point(color='purple', alpha=0.4) +
geom_abline() +
ggtitle(paste0("Nightlight Intensity (Philippines ", YEAR,"); Adj R2 = ", signif(summary(linear_reg)$adj.r.squared, 4))) +
xlab("Observed Expenditure") +
ylab("Predicted Expenditure")
ggplot(df, aes(x = .fitted, y = .resid)) +
geom_point(color='red', alpha=0.4) +
xlab("Fitted Wealth Index Factor Score") +
ylab("Linear Regression Residuals") +
ggtitle(paste0("Nightlights Regression Residuals (Philippines ",YEAR ,")"))
ggplot(nightlights, aes(x = consumption, y = nl_mean)) +
geom_point(color='blue', alpha=0.4) +
geom_smooth(method='loess', color='black') +
ggtitle(paste0("Consumption-based Wealth vs. Nightlight Intensity (Philippines ", YEAR,")")) +
xlab("Average Expenditure Provinces and NCR Cities (Pesos)") +
ylab("Nightlight Intensity")
ggplot(nightlights, aes(x = consumption, y = nl_mean)) +
geom_point(color='blue', alpha=0.4) +
geom_smooth(method='loess', color='black') +
ggtitle(paste0("Consumption-based Wealth vs. Nightlight Intensity (Philippines ", YEAR,")")) +
xlab("Average Annual Expenditure (Pesos)") +
ylab("Nightlight Intensity")
ggplot(nightlights, aes(x = consumption, y = nl_mean)) +
geom_point(color='blue', alpha=0.4) +
geom_smooth(method='loess', color='black') +
ggtitle(paste0("Consumption-based Wealth vs. Nightlight Intensity (Philippines ", YEAR,")")) +
xlab("Average Annual Expenditure (Pesos)") +
ylab("Mean Nightlight Intensity")
nightlights <- read.csv(FEATURES_Z)
nightlights$consumption <- nightlights$consumption/1000
ggplot(nightlights, aes(x = consumption, y = nl_mean)) +
geom_point(color='blue', alpha=0.4) +
geom_smooth(method='loess', color='black') +
ggtitle(paste0("Consumption-based Wealth vs. Nightlight Intensity (Philippines ", YEAR,")")) +
xlab("Average Annual Expenditure (Pesos)") +
ylab("Mean Nightlight Intensity")
ggplot(nightlights, aes(x = consumption, y = nl_mean)) +
geom_point(color='blue', alpha=0.4) +
geom_smooth(method='loess', color='black') +
ggtitle(paste0("Consumption-based Wealth vs. Nightlight Intensity (Philippines ", YEAR,")")) +
xlab("Average Annual Expenditure (Thousand Pesos)") +
ylab("Mean Nightlight Intensity")
linear_reg <- lm(consumption ~ nl_mean + nl_min + nl_max + nl_sd,
data = nightlights)
summary(linear_reg)
df <- augment(linear_reg)
ggplot(df, aes(x = consumption, y = .fitted)) +
geom_point(color='purple', alpha=0.4) +
geom_abline() +
ggtitle(paste0("Nightlight Intensity (Philippines ", YEAR,"); Adj R2 = ", signif(summary(linear_reg)$adj.r.squared, 4))) +
xlab("Observed Expenditure") +
ylab("Predicted Expenditure")
ggplot(nightlights, aes(x = consumption, y = nl_mean)) +
geom_point(color='blue', alpha=0.4) +
geom_smooth(method='loess', color='black') +
ggtitle(paste0("Consumption-based Wealth vs. Nightlight Intensity (Philippines ", YEAR,")")) +
xlab("Average Expenditure (Thousand Pesos)") +
ylab("Mean Nightlight Intensity")
ggplot(nightlights, aes(x = consumption, y = nl_mean)) +
geom_point(color='blue', alpha=0.4) +
geom_smooth(method='loess', color='black') +
ggtitle(paste0("Consumption-based Wealth vs. Nightlight Intensity (Philippines ", YEAR,")")) +
xlab("Average Expenditure (Thousand Pesos)") +
ylab("Mean Nightlight Intensity")
linear_reg <- lm(consumption ~ nl_mean + nl_min + nl_max + nl_sd,
data = nightlights)
summary(linear_reg)
ggplot(nightlights, aes(x = consumption, y = nl_mean)) +
geom_point(color='blue', alpha=0.4) +
geom_smooth(method='loess', color='black') +
ggtitle(paste0("Consumption-based Wealth vs. Nightlight Intensity (Philippines ", YEAR,")")) +
xlab("Average Expenditure (Thousand Pesos)") +
ylab("Mean Nightlight Intensity")
ggplot(nightlights, aes(x = consumption, y = nl_mean)) +
geom_point(color='blue', alpha=0.4, size=3) +
geom_smooth(method='loess', color='black') +
ggtitle(paste0("Consumption-based Wealth vs. Nightlight Intensity (Philippines ", YEAR,")")) +
xlab("Average Expenditure (Thousand Pesos)") +
ylab("Mean Nightlight Intensity")
ggplot(nightlights, aes(x = consumption, y = nl_mean)) +
geom_point(color='blue', alpha=0.4, size=4) +
geom_smooth(method='loess', color='black') +
ggtitle(paste0("Consumption-based Wealth vs. Nightlight Intensity (Philippines ", YEAR,")")) +
xlab("Average Expenditure (Thousand Pesos)") +
ylab("Mean Nightlight Intensity")
linear_reg <- lm(consumption ~ nl_mean + nl_min + nl_max + nl_sd,
data = nightlights)
summary(linear_reg)
df <- augment(linear_reg)
ggplot(df, aes(x = consumption, y = .fitted)) +
geom_point(color='purple', alpha=0.4, size=4) +
geom_abline() +
ggtitle(paste0("Nightlight Intensity (Philippines ", YEAR,"); Adj R2 = ", signif(summary(linear_reg)$adj.r.squared, 4))) +
xlab("Observed Average Expenditure ") +
ylab("Predicted Average Expenditure")
ggplot(df, aes(x = .fitted, y = .resid)) +
geom_point(color='red', alpha=0.4) +
xlab("Fitted Average Expenditure") +
ylab("Linear Regression Residuals") +
ggtitle(paste0("Nightlights Regression Residuals (Philippines ",YEAR ,")"))
rm(list=ls())
library(magrittr)
library(foreign)
library(plyr)
library(raster)
library(rgdal)
library(rgeos)
get.PH.raster <- function(file){
ph_bounds <- create.spPolygon(file)
return(crop(nl.raster, ph_bounds))
}
list.wrapper <- function(dir){
return(list.files(dir, include.dirs = FALSE, full.names=TRUE))
}
polyFromFile <- function(file){
poly.df <- read.table(file)
poly.m <- data.matrix(poly.df, rownames.force = NA)
return(poly.m)
}
create.spPolygon <- function(object){
if (length(object) == 1) {
poly <- polyFromFile(object)
} else {
poly <- lapply(object, polyFromFile)
}
return(spPolygons(poly))
}
get.nightlights <- function(shp){
nl <- extract(PH.raster, shp) %>% unlist()
return(nl)
}
read.shp <- function(file){
shp <- readOGR(dsn = paste0(SHAPEFILE_DIR, file), layer = file)
shp.t <- spTransform(shp, crs(nl.raster))
return(shp.t)
}
POLYGON_DIR <- "../data/input/Polygons/"
POLYGON_DIR <- "../data/input/Polygons/"
SHAPEFILE_DIR <- "../data/input/Shapefiles/"
PH_BOUNDARY <- "../data/input/PH_boundary.txt"
NIGHTLIGHTS <- "../data/input/F162009.v4b_web.stable_lights.avg_vis.tif"
SHAPE_OUT <- "../data/output/ShapePerProvince_PH.RData"
OUTPUT_DATA <- "../data/output/PH2009_nightlights.RData"
nl.raster <- raster(NIGHTLIGHTS)
PH.raster <- get.PH.raster(PH_BOUNDARY)
poly.dir.names <- list.dirs(POLYGON_DIR, recursive=FALSE, full.names=FALSE)
f <- list.files(POLYGON_DIR)
poly.files <- f[!f %in% poly.dir.names]
list.spatial1 <- lapply(poly.files, function(x){
return(paste0(POLYGON_DIR,x))
}) %>%
lapply(create.spPolygon)
list.spatial2 <- list.dirs(POLYGON_DIR, recursive=FALSE) %>%
lapply(list.wrapper) %>%
lapply(create.spPolygon)
shp.dir.names <- list.dirs(SHAPEFILE_DIR, recursive=FALSE, full.names=FALSE)
list.shp <- lapply(shp.dir.names, read.shp)
place_names <- c(poly.names, poly.dir.names, shp.dir.names)
list.shp.complete <- c(list.spatial1, list.spatial2, list.shp)
shp.dir.names <- list.dirs(SHAPEFILE_DIR, recursive=FALSE, full.names=FALSE)
list.shp <- lapply(shp.dir.names, read.shp)
poly.names <- lapply(poly.files, function(x){
return(substr(x, 1, nchar(x)-4))
})
place_names <- c(poly.names, poly.dir.names, shp.dir.names)
list.shp.complete <- c(list.spatial1, list.spatial2, list.shp)
list.nl <- lapply(list.shp.complete, get.nightlights)
nl.data <- mapply(c, place_names, list.nl)
save(nl.data, file=OUTPUT_DATA)
rm(list=ls())
library(dplyr)
library(broom)
NIGHTLIGHTS <- "../data/output/PH2012_nightlights.RData"
CONSUMPTION <- "../data/input/2012_FIES_clean.csv"
SHAPE_OUT <- "../data/output/ShapePerProvince_PH.RData"
OUT_DATA <- "../data/output/PH2012_features.csv"
# Load Data
load(NIGHTLIGHTS)
cons <- read.table(CONSUMPTION, sep=',', stringsAsFactors=FALSE)
names(cons) <- c("loc", "consumption")
# Helper Functions
get.features <- function(nl){
df <- data.frame(loc=character(length(nl)), stringsAsFactors=FALSE)
for (i in 1:length(nl)){
df$loc[i] <- nl[[i]][1]
nl.vals <- lapply(nl[[i]][(-1)], as.numeric) %>% unlist()
nl.vals[nl.vals==255] <- NULL
df$nl_mean[i] <- mean(nl.vals, na.rm = T)
df$nl_min[i] <- min(nl.vals, na.rm = T)
df$nl_max[i] <- max(nl.vals, na.rm = T)
df$nl_sd[i] <- sd(nl.vals, na.rm = T)
}
return(df)
}
# Get Nightlight Features
nl.features <- get.features(nl.data)
nl.features <- merge(nl.features, cons, by='loc', all=FALSE)
nl.features$consumption <- as.numeric(gsub(",","",nl.features$consumption))
write.csv(nl.features, file=OUT_DATA, row.names=FALSE)
rm(list=ls())
library(dplyr)
library(broom)
NIGHTLIGHTS <- "../data/output/PH2009_nightlights.RData"
CONSUMPTION <- "../data/input/2009_FIES_clean.csv"
SHAPE_OUT <- "../data/output/ShapePerProvince_PH.RData"
OUT_DATA <- "../data/output/PH2009_features.csv"
# Load Data
load(NIGHTLIGHTS)
cons <- read.table(CONSUMPTION, sep=',', stringsAsFactors=FALSE)
names(cons) <- c("loc", "consumption")
# Helper Functions
get.features <- function(nl){
df <- data.frame(loc=character(length(nl)), stringsAsFactors=FALSE)
for (i in 1:length(nl)){
df$loc[i] <- nl[[i]][1]
nl.vals <- lapply(nl[[i]][(-1)], as.numeric) %>% unlist()
nl.vals[nl.vals==255] <- NULL
df$nl_mean[i] <- mean(nl.vals, na.rm = T)
df$nl_min[i] <- min(nl.vals, na.rm = T)
df$nl_max[i] <- max(nl.vals, na.rm = T)
df$nl_sd[i] <- sd(nl.vals, na.rm = T)
}
return(df)
}
# Get Nightlight Features
nl.features <- get.features(nl.data)
nl.features <- merge(nl.features, cons, by='loc', all=FALSE)
nl.features$consumption <- as.numeric(gsub(",","",nl.features$consumption))
write.csv(nl.features, file=OUT_DATA, row.names=FALSE)
rm(list=ls())
library(dplyr)
library(ggplot2)
library(GGally)
library(glmnet)
library(broom)
YEAR <- "2009"
FEATURES <- paste0("../data/output/PH", YEAR, "_features_zero.csv")
nightlights <- read.csv(FEATURES_Z)
rm(list=ls())
library(dplyr)
library(ggplot2)
library(GGally)
library(glmnet)
library(broom)
YEAR <- "2009"
FEATURES <- paste0("../data/output/PH", YEAR, "_features_zero.csv")
nightlights <- read.csv(FEATURES)
rm(list=ls())
library(dplyr)
library(ggplot2)
library(GGally)
library(glmnet)
library(broom)
YEAR <- "2009"
FEATURES <- paste0("../data/output/PH", YEAR, "_features.csv")
nightlights <- read.csv(FEATURES)
nightlights$consumption <- nightlights$consumption/1000
ggplot(nightlights, aes(x = consumption, y = nl_mean)) +
geom_point(color='blue', alpha=0.4, size=4) +
geom_smooth(method='loess', color='black') +
ggtitle(paste0("Consumption-based Wealth vs. Nightlight Intensity (Philippines ", YEAR,")")) +
xlab("Average Expenditure (Thousand Pesos)") +
ylab("Mean Nightlight Intensity")
linear_reg <- lm(consumption ~ nl_mean + nl_min + nl_max + nl_sd,
data = nightlights)
summary(linear_reg)
df <- augment(linear_reg)
ggplot(df, aes(x = consumption, y = .fitted)) +
geom_point(color='purple', alpha=0.4, size=4) +
geom_abline() +
ggtitle(paste0("Nightlight Intensity (Philippines ", YEAR,"); Adj R2 = ", signif(summary(linear_reg)$adj.r.squared, 4))) +
xlab("Observed Average Expenditure ") +
ylab("Predicted Average Expenditure")
ggplot(df, aes(x = .fitted, y = .resid)) +
geom_point(color='red', alpha=0.4) +
xlab("Fitted Average Expenditure") +
ylab("Linear Regression Residuals") +
ggtitle(paste0("Nightlights Regression Residuals (Philippines ",YEAR ,")"))
ggplot(df, aes(x = .fitted, y = .resid)) +
geom_point(color='red', alpha=0.4, size=4) +
xlab("Fitted Average Expenditure") +
ylab("Linear Regression Residuals") +
ggtitle(paste0("Nightlights Regression Residuals (Philippines ",YEAR ,")"))
rm(list=ls())
library(dplyr)
library(ggplot2)
library(GGally)
library(glmnet)
library(broom)
YEAR <- "2012"
FEATURES <- paste0("../data/output/PH", YEAR, "_features.csv")
nightlights <- read.csv(FEATURES)
nightlights$consumption <- nightlights$consumption/1000
# Plot for Nightlight vs. Consumption
ggplot(nightlights, aes(x = consumption, y = nl_mean)) +
geom_point(color='blue', alpha=0.4, size=4) +
geom_smooth(method='loess', color='black') +
ggtitle(paste0("Consumption-based Wealth vs. Nightlight Intensity (Philippines ", YEAR,")")) +
xlab("Average Expenditure (Thousand Pesos)") +
ylab("Mean Nightlight Intensity")
# Regression on Nightlight Intensity Features
linear_reg <- lm(consumption ~ nl_mean + nl_min + nl_max + nl_sd,
data = nightlights)
summary(linear_reg)
df <- augment(linear_reg)
ggplot(df, aes(x = consumption, y = .fitted)) +
geom_point(color='purple', alpha=0.4, size=4) +
geom_abline() +
ggtitle(paste0("Nightlight Intensity (Philippines ", YEAR,"); Adj R2 = ", signif(summary(linear_reg)$adj.r.squared, 4))) +
xlab("Observed Average Expenditure ") +
ylab("Predicted Average Expenditure")
ggplot(df, aes(x = .fitted, y = .resid)) +
geom_point(color='red', alpha=0.4, size=4) +
xlab("Fitted Average Expenditure") +
ylab("Linear Regression Residuals") +
ggtitle(paste0("Nightlights Regression Residuals (Philippines ",YEAR ,")"))
